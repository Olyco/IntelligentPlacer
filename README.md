# IntelligentPlacer

## Постановка задачи

Требуется создать “Intelligent Placer” в виде python-библиотеки, который по переданной на вход фотографии нескольких предметов на светлой горизонтальной поверхности и многоугольнику будет понимать, можно ли расположить одновременно все эти предметы на плоскости так, чтобы они влезли в этот многоугольник. Предметы и горизонтальная поверхность, которые могут оказаться на фотографии, заранее известны. Также заранее известно направление вертикальной оси Z у этих предметов. Многоугольник в данной реализации задается фигурой, нарисованной темным маркером на белом листе бумаги, сфотографированной вместе с предметами.

## Требования ко входным данным
### Требования к фотографии
  1. Камера направлена перпендикулярно поверхности, допустимо незначительное отклонение от перпендикуляра не более 10 градусов
  2. Высота до камеры не более 40 см
  3. Расширение фотографии .jpeg
  4. Разрешение фотографии 4032х3024
### Требования к поверхности
  1. Поверхность, на которой расположены объекты, представляет собой два белых, ровных (без заломов) листа бумаги формата А4, не имеющих между собой пересечения
  2. Поверхность освещена сверху
  3. Углы и края листов четко видны на фоне поверхности стола и ничем не перекрываются
  4. На поверхности вне листов бумаги отсутствуют лишние предметы
  5. На поверхности отсутствуют тени от окружающих предметов и засвеченные участки
### Требования к набору предметов
  1. Предметы располагаются на левом листе бумаги
  2. Небольшие по размеру предметы должны попадать на фотографию целиком, не выходя за края листа
  3. Границы предмета четко выделяются на фоне белого листа бумаги
  4. Тени от предметов по возможности минимизированы
  5. Отсутствуют наложения предметов одного тестового набора друг на друга
  6. Предметы на фото не повторяются
  7. Допускается поворот предмета вокруг заданной оси Z, то есть предметы двигаются только поступательно в плоскости oXY
### Требования к многоугольнику
  1. Многоугольник расположен на правом листе бумаги, не выходит за контуры листа
  2. Многоугольник нарисован средним по толщине темным маркером (толщина линии составляет ~8 пикселей)
  3. Многоугольник образован замкнутой ломаной линией
  
## Выход
В результате работы программа выводит True, если предметы помещаются в многоугольник, False - в противном случае.

## План решения задачи
В решении поставленной задачи можно выделить четыре отдельных этапа:
  1. Предобработка фотографии для выделения на ней нужной нам поверхности из двух листов
  2. Распознавание предметов и многоугольника
  3. Сопоставление предметов тестового набора с шаблонными предметами
  4. Упаковка предметов в многоугольник
### 1) Этап предобработки
  - Используя бинаризацию и морфологические операции, выделяем листы на поверхности стола, выделяем на полученной маске отдельно левый, отдельно правый лист
  - Поочередно применяя маску левого и правого листа получаем 2 изображаения внутренних областей - набора предметов на листе и многоугольник на листе

### 2) Распознавание
  - Многоугольник:
    - Так как контур многоугольника четко отделим от белого фона, есть сильный перепад интенсивности, используем для разпознавания границ алгоритм Canny
    - Выполняем заливку внутренней области
    - С помощью бинаризации выделяем залитый многоугольник
  - Предметы:
    - Для работы с каждым предметом отдельно применением бинаризации и морфологических операций выделим предметы из набора отдельными масками. _Предположительно, можно улучшить результат бинаризации, если предварительно применить детектор Харриса. Густота найденных особых точек наибольшая в области предметов. Можно попробовать, выделяя в отдельные группы точки, которые скорее всего относятся к одному предмету, заливать область внутри предмета. Таким образом уточнять компоненты связности на маске._
    - Применяя маски предметов к исходному изображению, выделяем каждый объект в отдельное изображение
    
### 3) Сопоставление с шаблоном
Считая что на шаблонных изображениях отдельных предметов минимизирован угол отклонения камеры от перпендикуляра к поверхности, наилучшая освещенность, будем использовать для упаковки именно шаблонные предметы.
  - Применяя детектор Харриса, найдем особые точки выделенных и шаблонных предметов
  - Используя дескриптор SIFT, сопоставляем предметы с шаблонами
  
### 4) Упаковка предметов в многоугольник
Стремимся уменьшить перебор всевозможных вариантов.
  - Находим площади всех предметов и многоугольника, сортируем по убыванию, будем упаковывать, начиная с предмета наибольшей площади
  - Решаем задачу, как это бы делал человек: берем предмет наибольшей площади, укладываем поверх многоугольника и начинаем перемещать и поворачивать в плоскости многоугольника до тех пор, пока пересечение предмета с границей многоугольника не будет нулевым
  - Альтернативный вариант - решение задачи двумерной упаковки. В таком случае предполагается приближение предмета описывающим его прямоугольником, и с используемым набором предметов такое приближение часто может привести к выдаче неправильного ответа. 
